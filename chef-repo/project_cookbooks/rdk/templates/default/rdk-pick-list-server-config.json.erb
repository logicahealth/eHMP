{
    "//notice": "This file is automatically generated. Any edits will be overwritten.",
    "name": "The writeback picklist running configuration",
    "version": "<%= node[:rdk][:version] %>",
    "edition": "<%= node[:development] ? "ONC" : "VIEWER" %>",
    "environment": "<%= node[:development] ? "development" : "production" %>",
    "corsEnabled": false,
    "rootPath": "/resource/write-pick-list",
    "externalProtocol": "http",
    "secret": <%= @secure_passcode_list %>,
    "sessionLength": 900000,
    "cookiePrefix": "<%= @cookie_prefix %>",
    "maxSockets": <%= node[:rdk][:services][:pick_list][:max_sockets] %>,
    "pickListRpcDirectCall": false,
    "pickListsNoParams":"allergies-symptoms,vitals,medication-schedules,pki-enabled,providers",
    "pickListInitializeInterval":"0 23 * * * *",
    "refreshInterval" :{
        "9E7A":{
            "allergies-symptoms":"3",
            "vitals":"3",
            "medication-schedules":"3",
            "pki-enabled":"3",
            "printer-devices":"3",
            "lab-order-specimens":"3",
            "providers":"3"
        },
        "C877":{
            "allergies-symptoms":"3",
            "vitals":"3",
            "medication-schedules":"3",
            "pki-enabled":"3",
            "printer-devices":"3",
            "lab-order-specimens":"3",
            "providers":"3"
        }
    },
    "inMemoryPickLists":"allergies-symptoms,vitals,medication-schedules,pki-enabled,printer-devices,lab-order-specimens,providers",
    "enableMultidivisionProxyHealthcheck": true,
    "appServer": {
        "port": <%= @port %>
    },
    "fetchServer": {
        "baseUrl": "http://<%= @fetch_host %>"
    },
    "writeBackServer": {
        "baseUrl": "http://<%= @write_back_host %>"
    },
    "timeoutMillis": 120000,
    "responseTimeoutMillis": 420000,
    "maxListeners": 50,
    "requestTrace": {
        "active": true,
        "logIdParam": "logId",
        "requestIdParam": "requestId"
    },
    "pdpConfig": {
        "ruleFile": "./rules.js"
    },
    "rpcConfig": {
        "context": "HMP UI CONTEXT"
    },
    "vistaSites": {
        <% @vista_sites.each_with_index do |site, index| %>
        "<%= site['vista']['site_id']%>": {
            "division": <%= site['vista']['division'].to_json %>,
            "environment": "development",
            "host": "<%= site['ipaddress']%>",
            "localIP": "10.2.2.1",
            "localAddress": "localhost",
            "port": <%= site['vista']['rpc_port']%>,
            "production": <%= site['vista']['production']%>,
            "accessCode": "<%= site['vista']['multidivision_proxy_access_code'].nil? ? site['vista']['access_code'] : site['vista']['multidivision_proxy_access_code']%>",
            "verifyCode": "<%= site['vista']['multidivision_proxy_verify_code'].nil? ? site['vista']['verify_code'] : site['vista']['multidivision_proxy_verify_code']%>",
            "infoButtonOid": "1.3.6.1.4.1.3768",
            "abbreviation": "<%= site['vista']['abbreviation']%>"
        }<%= ',' unless index == @vista_sites.size - 1 %>
        <% end %>
    },
    "pickLists":[
    "allergy",
    "problem",
    "vital"
    ],
    "mvi": {
        "baseUrl": "<%= @mvi['mvi']['protocol']%>://<%= @mvi['ipaddress']%>:<%= @mvi['mvi']['port']%>",
        "senderCode": "<%= @mvi['mvi']['sender_code']%>",
        "search": {
            "path": "<%= @mvi['mvi']['search_path']%>"
        },
        "sync": {
            "path": "<%= @mvi['mvi']['sync_path']%>"
        },
        "agentOptions": {
            "key": <%= @mvi['mvi']['agent_options']['key'].nil? ? "null" : "\"#{@mvi['mvi']['agent_options']['key']}\"" %>,
            "cert": <%= @mvi['mvi']['agent_options']['cert'].nil? ? "null" : "\"#{@mvi['mvi']['agent_options']['cert']}\"" %>,
            "rejectUnauthorized": <%= @mvi['mvi']['agent_options']['reject_unauthorized'].nil? ? "null" : "\"#{@mvi['mvi']['agent_options']['reject_unauthorized']}\"" %>,
            "requestCert": <%= @mvi['mvi']['agent_options']['request_cert'].nil? ? "null" : "\"#{@mvi['mvi']['agent_options']['request_cert']}\"" %>,
            "ca": <%= @mvi['mvi']['agent_options']['ca'].nil? ? "null" : @mvi['mvi']['agent_options']['ca'] %>,
            "passphrase": <%= @mvi['mvi']['agent_options']['passphrase'].nil? ? "null" : "\"#{@mvi['mvi']['agent_options']['passphrase']}\"" %>
        }
    },
    "vhic": {
        "baseUrl": "<%= @vhic['vhic']['protocol']%>://<%= @vhic['ipaddress']%>:<%= @vhic['vhic']['port']%>",
        "senderCode": "<%= @vhic['vhic']['sender_code']%>",
        "search": {
            "path": "<%= @vhic['vhic']['search_path']%>"
        },
        "sync": {
            "path": "<%= @vhic['vhic']['sync_path']%>"
        },
        "agentOptions": {
            "key": <%= @vhic['vhic']['agent_options']['key'].nil? ? "null" : "\"#{@vhic['vhic']['agent_options']['key']}\"" %>,
            "cert": <%= @vhic['vhic']['agent_options']['cert'].nil? ? "null" : "\"#{@vhic['vhic']['agent_options']['cert']}\"" %>,
            "rejectUnauthorized": <%= @vhic['vhic']['agent_options']['reject_unauthorized'].nil? ? "null" : "\"#{@vhic['vhic']['agent_options']['reject_unauthorized']}\"" %>,
            "requestCert": <%= @vhic['vhic']['agent_options']['request_cert'].nil? ? "null" : "\"#{@vhic['vhic']['agent_options']['request_cert']}\"" %>,
            "ca": <%= @vhic['vhic']['agent_options']['ca'].nil? ? "null" : @vhic['vhic']['agent_options']['ca'] %>,
            "passphrase": <%= @vhic['vhic']['agent_options']['passphrase'].nil? ? "null" : "\"#{@vhic['vhic']['agent_options']['passphrase']}\"" %>
        }
    },
    "vxSyncServer": {
        "baseUrl": "http://<%= @vxsync['ipaddress']%>:8080"
    },
    "solrServer": {
        "baseUrl": "http://<%= @solr['ipaddress']%>:8983",
        "url": "/solr/vpr"
    },
    "asuServer": {
        "baseUrl": "http://<%= @asu['ipaddress']%>:<%= @asu['asu']['server_port']%>",
        "timeout": <%= @asu['asu']['timeout']%>
    },
    "jdsServer": {
        "baseUrl": "http://<%= @jds['ipaddress']%>:<%= @jds['jds']['cache_listener_ports']['general']%>"
    },
    "generalPurposeJdsServer": {
        "baseUrl": "http://<%= @pjds['ipaddress']%>:<%= @pjds['jds']['cache_listener_ports']['general']%>"
    },
    <% if !@jbpm.nil? %>
    "jbpm": {
        "baseUrl": "http://<%= @jbpm['ipaddress']%>:8080",
        "apiPath": "/business-central/rest",
        "adminUser": {
            "username": "<%= @jbpm[:jbpm][:install][:admin_user] %>",
            "password": "<%= @jbpm_admin_password %>"
        },
        "nurseUser": {
            "username": "Susan",
            "password": "<%= @jbpm_nurseuser_password %>"
        },
        "healthcheckEndpoint": "/history/instances",
        "deployments": {
            "All": "example:testproject:1.3.0"
        },
        "activityDatabase": {
            "user": "activitydbuser",
            "password": "<%= @jbpm_activitydbuser_password %>",
            "connectString": "<%= @jbpm['ipaddress']%>:<%= @jbpm[:jbpm][:oracle_config][:port] %>/<%= @jbpm['ehmp_oracle']['oracle_sid'] %>"
        }
    },
    <% end %>
    "jdsSync": {
        "settings": {
            "waitMillis": <%= @jds_sync_settings['waitMillis'] %>,
            "timeoutMillis": <%= @jds_sync_settings['timeoutMillis'] %>,
            "syncExistsWaitDelayMillis": <%= @jds_sync_settings['syncExistsWaitDelayMillis'] %>
        }
    },
    "resync": {
        "openJobsTimeoutMillis": <%= @resync_settings['openJobsTimeoutMillis'] %>,
        "inProgressTimeoutMillis": <%= @resync_settings['inProgressTimeoutMillis'] %>,
        "inactivityTimeoutMillis": <%= @resync_settings['inactivityTimeoutMillis'] %>,
        "lastSyncMaxIntervalMillis": <%= @resync_settings['lastSyncMaxIntervalMillis'] %>
    },
    "vxSyncComplexNote": {
        "getComplexNote": {
            "timeout": 120000,
            "port": <%= @complex_note_port %>,
            "rejectUnauthorized": false,
            "requestCert": true,
            "agent": false
        }
    },
    "loggers": [
        {
            "name": "res-server",
            "streams": [
                {
                    "level": "<%= @node['rdk']['log_level']['pick_list_server'] %>",
                    "path": "<%= @node['rdk']['log_dir']  %>/pick_list_server<%= @index == 0 ? '' : "-#{@index}" %>.log"
                }
            ]
        },
        {
            "name": "audit",
            "streams": [
                {
                    "level": "<%= @node['rdk']['log_level']['audit']['pick_list_server'] %>",
                    "path": "<%= @node['rdk']['log_dir']  %>/pick_list_server_audit<%= @index == 0 ? '' : "-#{@index}" %>.log"
                }
            ]
        }
    ],
    "interceptors": {
        <% @node[:rdk][:interceptors].each_with_index do |interceptor, index| %>
        "<%= interceptor[:name]%>": {
            <% interceptor.each_with_index do |(key, value), hash_index| %>
            <% if key == 'name' then next end %>
            "<%= key %>": <%= value %><%= ',' unless hash_index == interceptor.length - 1 %>
            <% end %>
        }<%= ',' unless index == @node[:rdk][:interceptors].size - 1 %>
        <% end %>
    }
}
